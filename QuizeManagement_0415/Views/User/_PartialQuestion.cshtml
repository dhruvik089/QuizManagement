@model List<QuizeManagement.Models.ViewModel.OptionsModel>

<div class="container">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Question</h5>
            <h5> <b> @ViewBag.Questions</b></h5>
            <span><h6 id="optionValidation"></h6></span>
            <input type="hidden" id="currentQuestionIndex" value="@ViewBag.questionId" />
            <input type="hidden" name="quiz_id" id="quiz_id" value="@( ViewBag.quizID )" class="form-control" hidden />
            <input type="text" name="UserId" id="UserId" value="@(ViewBag.userId)" hidden />
            <div class="row">
                @foreach (var item in Model)
                {
                    <div class="col-md-6">
                        <div class="option-border" onclick="document.getElementById('option_@item.Option_id').checked = true;">
                            <div class="form-check d-flex align-items-center">
                                <input class="form-check-input" type="radio" id="option_@item.Option_id" name="options" value="@item.Option_id">
                                <label class="form-check-label mb-0" for="option_@item.Option_id">
                                    @item.Option_text
                                </label>
                            </div>
                        </div>
                    </div>
                }

                <a class="btn btn-outline-primary" id="nextQuestion" onsubmit="result()" onclick="nextQuestion()">Next</a>

                @Html.ActionLink("View Result", "Result", "User", htmlAttributes: new { @class = "btn btn-outline-danger d-none submitButton" })
                @*<button type="submit" onclick="result()" class="btn btn-outline-primary d-none" id="submitButton">Submit</button>*@

            </div>
        </div>
    </div>
</div>

<script>
    var count = 0
    const updateQuestion = (questionIndex) => {
        console.log("questionIndex " + questionIndex);
        console.log("Count " + count)
        $.ajax({
            url: "/user/ConfirmStartQuiz?quetionid=" + questionIndex,
            dataType: "html",
            success: function (result) {
                $(".card-body").html(result);

                document.getElementById('currentQuestionIndex').value = questionIndex;
                if (count < 4) {
                    $("#nextQuestion").show()
                } else {
                    $(".submitButton").addClass("d-block")
                    $(".submitButton").removeClass("d-none")
                    $("#nextQuestion").hide()
                }
            }
        });
    };

    const nextQuestion = () => {
        var questionIndex = parseInt(document.getElementById('currentQuestionIndex').value);
        console.log(questionIndex);
       
        if (count < 5) {

            var userId = $('#UserId').val();
            var QuizId = $('#quiz_id').val();
            var selectOption = document.querySelector('input[name="options"]:checked');
            if (!selectOption) {
                $('#optionValidation').text("Please select one option").addClass('text-danger');
                return false;
            }
            else {

                var selectedValue = selectOption.value;
                count = count + 1;
                var answerData = {
                    question_id: questionIndex,
                    selected_option_id: selectedValue,
                    user_id: userId,
                    quiz_id: QuizId
                }

                updateQuestion(questionIndex + 1);
                $.ajax({
                    url: '/User/AddUserAnswers',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(answerData),
                    success: function (response) {
                        console.log(response);
                    },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                    }

                });
            }
        }
    };

</script>
